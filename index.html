<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>最終課題</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js の読み込み -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <!-- Bootstrap の読み込み -->

    <script>
        let result;

        window.addEventListener("load", async() => {

            const uri = createURI(
                id = "1Nq8hbrDXfKIksrEuFYLasmYuwBlIVGpgS7EaMyaq0kM",
                sheet = "フォームの回答%201",
                key = "AIzaSyCs_4DjHyxYoFIFptkXE0lk4Vx4AxPISCQ"
            )

            await fetch(uri)
                .then(response => response.text())
                .then(data => {
                    result = JSON.parse(data).values;
                })

            let dataHash = {};

            for (let i = 0; i < result[0].length; i++) {
                dataHash[result[0][i]] = [];
                for (let j = 1; j < result.length; j++) {
                    dataHash[result[0][i]][j - 1] = result[j][i];
                }
            }

            const plugins = {
                title: {
                    display: true,
                    text: "タイトル",
                    color: "rgba(245, 245, 245, 1.0)",
                    font: {
                        size: 18
                    }
                },
                subtitle: {
                    display: true,
                    text: "サブタイトル",
                    position: "bottom",
                    color: "rgba(192, 192, 192, 1.0)",
                    font: {
                        size: 15
                    }
                },
                legend: {
                    position: "bottom",
                    labels: {
                        color: "rgba(245, 245, 245, 1.0)",
                        font: {
                            size: 14,
                        }
                    },
                },
                tooltip: {
                    backgroundColor: "rgba(245, 245, 245, 0.85)",
                    titleColor: "rgba(33, 37, 41, 1.0)",
                    bodyColor: "rgba(33, 37, 41, 1.0)",
                    borderWidth: 1.0,
                    borderColor: "rgba(33, 37, 41, 1.0)"
                }
            }

            const optionsHistFrame = {
                barPercentage: 1.0,
                categoryPercentage: 1.0,
                scales: {
                    x: {
                        grid: {
                            color: "rgba(245, 245, 245, 0.5)"
                        },
                        ticks: {
                            color: "rgba(245, 245, 245, 1.0)"
                        }
                    },
                    y: {
                        grid: {
                            color: "rgba(245, 245, 245, 0.5)"
                        },
                        ticks: {
                            stepSize: 1,
                            color: "rgba(245, 245, 245, 1.0)"
                        }
                    },
                },
                plugins: plugins
            }

            // ヒストグラム

            const LimitsHash = {
                "年齢 (歳)": [18, 19, 20, 21, 22, 23, 24, 25, 26],
                "身長 (cm)": [140, 145, 150, 155, 160, 165, 170, 175, 180, 185, 190],
                "平均睡眠時間 (時間)": [5, 5.5, 6, 6.5, 7, 7.5, 8, 8.5, 9, 9.5, 10],
                "平熱 (℃)": [35, 35.4, 35.8, 36.2, 36.6, 37.0, 37.4, 37.8],
            };

            let ageRanks = createRanks(LimitsHash["年齢 (歳)"]);
            let heightRanks = createRanks(LimitsHash["身長 (cm)"]);
            let sleepRanks = createRanks(LimitsHash["平均睡眠時間 (時間)"]);
            let temperatureRanks = createRanks(LimitsHash["平熱 (℃)"]);

            let ageFrequencies = createFrequencies("年齢 (歳)", LimitsHash["年齢 (歳)"]);
            let heightFrequencies = createFrequencies("身長 (cm)", LimitsHash["身長 (cm)"]);
            let maleHeightFrequencies = createFrequencies("身長 (cm)", LimitsHash["身長 (cm)"], gender = "male");
            let femaleHeightFrequencies = createFrequencies("身長 (cm)", LimitsHash["身長 (cm)"], gender = "female");
            let sleepFrequencies = createFrequencies("平均睡眠時間 (時間)", LimitsHash["平均睡眠時間 (時間)"]);
            let temperatureFrequencies = createFrequencies("平熱 (℃)", LimitsHash["平熱 (℃)"]);
            let maleTemperatureFrequencies = createFrequencies("平熱 (℃)", LimitsHash["平熱 (℃)"], gender = "male");
            let femaleTemperatureFrequencies = createFrequencies("平熱 (℃)", LimitsHash["平熱 (℃)"], gender = "female");

            const dataAge = {
                labels: ageRanks,
                datasets: [{
                    label: "年齢",
                    backgroundColor: "rgba(255, 250, 205, 0.6)",
                    borderColor: "rgba(255, 250, 205, 1.0)",
                    borderWidth: 1.0,
                    data: ageFrequencies
                }]
            };

            const dataHeightAll = {
                labels: heightRanks,
                datasets: [{
                    label: "身長",
                    backgroundColor: "rgba(255, 250, 205, 0.6)",
                    borderColor: "rgba(255, 250, 205, 1.0)",
                    borderWidth: 1.0,
                    data: heightFrequencies
                }]
            };

            const dataHeightGenders = {
                labels: heightRanks,
                datasets: [{
                    label: "身長 (男性)",
                    backgroundColor: "rgba(135, 206, 250, 0.6)",
                    borderColor: "rgba(135, 206, 250, 1.0)",
                    borderWidth: 1.0,
                    data: maleHeightFrequencies
                }, {
                    label: "身長 (女性)",
                    backgroundColor: "rgba(255, 182, 193, 0.6)",
                    borderColor: "rgba(255, 182, 193, 1.0)",
                    borderWidth: 1.0,
                    data: femaleHeightFrequencies
                }]
            }

            const dataSleep = {
                labels: sleepRanks,
                datasets: [{
                    label: "平均睡眠時間",
                    backgroundColor: "rgba(255, 250, 205, 0.6)",
                    borderColor: "rgba(255, 250, 205, 1.0)",
                    borderWidth: 1.0,
                    data: sleepFrequencies
                }]
            };

            const dataTemperatureAll = {
                labels: temperatureRanks,
                datasets: [{
                    label: "平熱",
                    backgroundColor: "rgba(255, 250, 205, 0.6)",
                    borderColor: "rgba(255, 250, 205, 1.0)",
                    borderWidth: 1.0,
                    data: temperatureFrequencies
                }]
            };

            const dataTemperatureGenders = {
                labels: temperatureRanks,
                datasets: [{
                    label: "平熱 (男性)",
                    backgroundColor: "rgba(135, 206, 250, 0.6)",
                    borderColor: "rgba(135, 206, 250, 1.0)",
                    borderWidth: 1.0,
                    data: maleTemperatureFrequencies
                }, {
                    label: "平熱 (女性)",
                    backgroundColor: "rgba(255, 182, 193, 0.6)",
                    borderColor: "rgba(255, 182, 193, 1.0)",
                    borderWidth: 1.0,
                    data: femaleTemperatureFrequencies
                }]
            }

            let ageSubtitle = createSubtitleHist([...dataHash["年齢 (歳)"]]);
            let heightAllSubtitle = createSubtitleHist([...dataHash["身長 (cm)"]]);
            let heightGenderSubtitles = [
                "[男性] " + createSubtitleHist(devideByGenders("身長 (cm)", "男性")),
                "[女性] " + createSubtitleHist(devideByGenders("身長 (cm)", "女性"))
            ];
            let sleepSubtitle = createSubtitleHist([...dataHash["平均睡眠時間 (時間)"]]);
            let temperatureSubtitle = createSubtitleHist([...dataHash["平熱 (℃)"]]);
            let temperatureGenderSubtitles = [
                "[男性] " + createSubtitleHist(devideByGenders("平熱 (℃)", "男性")),
                "[女性] " + createSubtitleHist(devideByGenders("平熱 (℃)", "女性"))
            ];

            let optionsAge = createOptions(optionsHistFrame, "年齢 (歳)", ageSubtitle);
            let optionsHeightAll = createOptions(optionsHistFrame, "身長 (cm)", heightAllSubtitle);
            let optionsHeightGenders = createOptions(optionsHistFrame, "身長 (cm) [男女別]", heightGenderSubtitles);
            let optionsSleep = createOptions(optionsHistFrame, "平均睡眠時間 (時間)", sleepSubtitle);
            let optionsTemperatureAll = createOptions(optionsHistFrame, "平熱 (℃)", temperatureSubtitle);
            let optionsTemperatureGenders = createOptions(optionsHistFrame, "平熱 (℃) [男女別]", temperatureGenderSubtitles);

            const configAge = {
                type: "bar",
                data: dataAge,
                options: optionsAge
            };
            const configHeightAll = {
                type: "bar",
                data: dataHeightAll,
                options: optionsHeightAll
            };
            const configHeightGenders = {
                type: "bar",
                data: dataHeightGenders,
                options: optionsHeightGenders
            };
            const configSleep = {
                type: "bar",
                data: dataSleep,
                options: optionsSleep
            };
            const configTemperatureAll = {
                type: "bar",
                data: dataTemperatureAll,
                options: optionsTemperatureAll
            };
            const configTemperatureGenders = {
                type: "bar",
                data: dataTemperatureGenders,
                options: optionsTemperatureGenders
            };

            var histAge = new Chart(document.getElementById("histAge"), configAge);
            var histHeightAll = new Chart(document.getElementById("histHeightAll"), configHeightAll);
            var histHeightGenders = new Chart(document.getElementById("histHeightGenders"), configHeightGenders);
            var histSleep = new Chart(document.getElementById("histSleep"), configSleep);
            var histTemperatureAll = new Chart(document.getElementById("histTemperatureAll"), configTemperatureAll);
            var histTemperatureGenders = new Chart(document.getElementById("histTemperatureGenders"), configTemperatureGenders);

            // 円グラフ

            const labelsHash = {
                "性別": ["男性", "女性"],
                "好きな教科は": ["国語", "数学", "社会", "理科", "英語"],
                "朝食でよく食べるのは": ["ご飯", "パン"],
                "どちらかというと得意なのは": ["絵を描く", "歌を歌う"],
                "道に1万円が落ちていたら": ["交番に届ける", "見て見ぬふりする", "こっそり財布にしまう"],
                "凄惨な事件のニュースを見てまず感じるのは": [
                    "被害者と遺族がかわいそうだ", "加害者にも悲しい過去があるはず",
                    "私や家族も巻き込まれていたかも", "自分じゃなくてよかった"
                ],
                "早起きが苦手だ": ["1", "2", "3", "4"],
                "勉強が好きだ": ["1", "2", "3", "4"],
                "プログラミングができる": ["1", "2", "3", "4"],
                "週末に出かけるのが好きだ": ["1", "2", "3", "4"],
                "自分から話すより聞き手に回るほうが多い": ["1", "2", "3", "4"],
                "嫌なことがあっても一晩寝ると忘れる": ["1", "2", "3", "4"],
                "空想にふけるのが好きだ": ["1", "2", "3", "4"],
                "他の人を褒めるのは得意だ": ["1", "2", "3", "4"]
            }

            let genderArray = createArray("性別");
            let subjectArray = createArray("好きな教科は");
            let breakfastArray = createArray("朝食でよく食べるのは");
            let artArray = createArray("どちらかというと得意なのは");
            let billArray = createArray("道に1万円が落ちていたら");
            let newsArray = createArray("凄惨な事件のニュースを見てまず感じるのは");
            let getUpArray = createArray("早起きが苦手だ");
            let studyArray = createArray("勉強が好きだ");
            let programmingArray = createArray("プログラミングができる");
            let goOutArray = createArray("週末に出かけるのが好きだ");
            let listenArray = createArray("自分から話すより聞き手に回るほうが多い");
            let recoveryArray = createArray("嫌なことがあっても一晩寝ると忘れる");
            let daydreamArray = createArray("空想にふけるのが好きだ");
            let praiseArray = createArray("他の人を褒めるのは得意だ");

            const dataGender = {
                labels: labelsHash["性別"],
                datasets: [{
                    label: "性別",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)"
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: genderArray
                }]
            };

            const dataSubject = {
                labels: labelsHash["好きな教科は"],
                datasets: [{
                    label: "好きな教科",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                        "rgba(147, 112, 219, 0.6)"
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: subjectArray
                }]
            };

            const dataBreakfast = {
                labels: labelsHash["朝食でよく食べるのは"],
                datasets: [{
                    label: "朝食はご飯かパンか",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: breakfastArray
                }]
            };

            const dataArt = {
                labels: labelsHash["どちらかというと得意なのは"],
                datasets: [{
                    label: "絵と歌のどちらが得意か",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: artArray
                }]
            };

            const dataBill = {
                labels: labelsHash["道に1万円が落ちていたら"],
                datasets: [{
                    label: "道に1万円が落ちていたときの反応",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: billArray
                }]
            };

            const dataNews = {
                labels: labelsHash["凄惨な事件のニュースを見てまず感じるのは"],
                datasets: [{
                    label: "凄惨な事件のニュースへの反応",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: newsArray
                }]
            };

            const fourSelectionLabels = ["あてはまる", "ややあてはまる", "あまりあてはまらない", "あてはまらない"];

            const dataGetUp = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "早起きが苦手だ",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: getUpArray
                }]
            };

            const dataStudy = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "勉強が好きだ",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: studyArray
                }]
            };

            const dataProgramming = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "プログラミングができる",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: programmingArray
                }]
            };

            const dataGoOut = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "週末に出かけるのが好きだ",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: goOutArray
                }]
            };

            const dataListen = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "自分から話すより聞き手に回るほうが多い",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: listenArray
                }]
            };

            const dataRecovery = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "嫌なことがあっても一晩寝ると忘れる",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: recoveryArray
                }]
            };

            const dataDaydream = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "空想にふけるのが好きだ",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: daydreamArray
                }]
            };

            const dataPraise = {
                labels: fourSelectionLabels,
                datasets: [{
                    label: "他の人を褒めるのは得意だ",
                    backgroundColor: [
                        "rgba(135, 206, 250, 0.6)",
                        "rgba(255, 182, 193, 0.6)",
                        "rgba(255, 250, 205, 0.6)",
                        "rgba(60, 179, 113, 0.6)",
                    ],
                    borderColor: "rgba(245, 245, 245, 1.0)",
                    borderWidth: 1.0,
                    data: praiseArray
                }]
            };

            const optionsPieFrame = {
                animation: {
                    animateScale: true
                },
                plugins: plugins
            }

            let genderSubtitle = createSubtitlePie(genderArray);
            let subjectSubtitle = createSubtitlePie(subjectArray);
            let breakfastSubtitle = createSubtitlePie(breakfastArray);
            let artSubtitle = createSubtitlePie(artArray);
            let billSubtitle = createSubtitlePie(billArray);
            let newsSubtitle = createSubtitlePie(newsArray);
            let getUpSubtitle = createSubtitlePie(getUpArray);
            let studySubtitle = createSubtitlePie(studyArray);
            let programmingSubtitle = createSubtitlePie(programmingArray);
            let goOutSubtitle = createSubtitlePie(goOutArray);
            let listenSubtitle = createSubtitlePie(listenArray);
            let recoverySubtitle = createSubtitlePie(recoveryArray);
            let daydreamSubtitle = createSubtitlePie(daydreamArray);
            let praiseSubtitle = createSubtitlePie(praiseArray);

            const optionsGender = createOptions(optionsPieFrame, "性別", genderSubtitle);
            const optionsSubject = createOptions(optionsPieFrame, "好きな教科", subjectSubtitle);
            const optionsBreakfast = createOptions(optionsPieFrame, "朝食はご飯かパンか", breakfastSubtitle);
            const optionsArt = createOptions(optionsPieFrame, "絵と歌のどちらが得意か", artSubtitle);
            const optionsBill = createOptions(optionsPieFrame, "道に1万円が落ちていたときの反応", billSubtitle);
            const optionsNews = createOptions(optionsPieFrame, "凄惨な事件のニュースへの反応", newsSubtitle);
            const optionsGetUp = createOptions(optionsPieFrame, "早起きが苦手だ", getUpSubtitle);
            const optionsStudy = createOptions(optionsPieFrame, "勉強が好きだ", studySubtitle);
            const optionsProgramming = createOptions(optionsPieFrame, "プログラミングができる", programmingSubtitle);
            const optionsGoOut = createOptions(optionsPieFrame, "週末に出かけるのが好きだ", goOutSubtitle);
            const optionsListen = createOptions(optionsPieFrame, "自分から話すより聞き手に回るほうが多い", listenSubtitle);
            const optionsRecovery = createOptions(optionsPieFrame, "嫌なことがあっても一晩寝ると忘れる", recoverySubtitle);
            const optionsDaydream = createOptions(optionsPieFrame, "空想にふけるのが好きだ", daydreamSubtitle);
            const optionsPraise = createOptions(optionsPieFrame, "他の人を褒めるのは得意だ", praiseSubtitle);

            const configGender = {
                type: "pie",
                data: dataGender,
                options: optionsGender
            };

            const configSubject = {
                type: "pie",
                data: dataSubject,
                options: optionsSubject
            };

            const configBreakfast = {
                type: "pie",
                data: dataBreakfast,
                options: optionsBreakfast
            };

            const configArt = {
                type: "pie",
                data: dataArt,
                options: optionsArt
            };

            const configBill = {
                type: "pie",
                data: dataBill,
                options: optionsBill
            };

            const configNews = {
                type: "pie",
                data: dataNews,
                options: optionsNews
            };

            const configGetUp = {
                type: "pie",
                data: dataGetUp,
                options: optionsGetUp
            };

            const configStudy = {
                type: "pie",
                data: dataStudy,
                options: optionsStudy
            };

            const configProgramming = {
                type: "pie",
                data: dataProgramming,
                options: optionsProgramming
            };

            const configGoOut = {
                type: "pie",
                data: dataGoOut,
                options: optionsGoOut
            };

            const configListen = {
                type: "pie",
                data: dataListen,
                options: optionsListen
            };

            const configRecovery = {
                type: "pie",
                data: dataRecovery,
                options: optionsRecovery
            };

            const configDaydream = {
                type: "pie",
                data: dataDaydream,
                options: optionsDaydream
            };

            const configPraise = {
                type: "pie",
                data: dataPraise,
                options: optionsPraise
            };

            var pieGender = new Chart(document.getElementById("pieGender"), configGender);
            var pieGender = new Chart(document.getElementById("pieSubject"), configSubject);
            var pieBreakfast = new Chart(document.getElementById("pieBreakfast"), configBreakfast);
            var pieArt = new Chart(document.getElementById("pieArt"), configArt);
            var pieBill = new Chart(document.getElementById("pieBill"), configBill);
            var pieNews = new Chart(document.getElementById("pieNews"), configNews);
            var pieGetUp = new Chart(document.getElementById("pieGetUp"), configGetUp);
            var pieStudy = new Chart(document.getElementById("pieStudy"), configStudy);
            var pieProgramming = new Chart(document.getElementById("pieProgramming"), configProgramming);
            var pieGoOut = new Chart(document.getElementById("pieGoOut"), configGoOut);
            var pieListen = new Chart(document.getElementById("pieListen"), configListen);
            var pieRecovery = new Chart(document.getElementById("pieRecovery"), configRecovery);
            var pieDaydream = new Chart(document.getElementById("pieDaydream"), configDaydream);
            var piePraise = new Chart(document.getElementById("piePraise"), configPraise);

            // バブルチャート

            let getUpGoOutArray = createBubbleDataset(dataHash["早起きが苦手だ"], dataHash["週末に出かけるのが好きだ"]);
            let studyProgrammingArray = createBubbleDataset(dataHash["勉強が好きだ"], dataHash["プログラミングができる"]);
            let listenPraiseArray = createBubbleDataset(dataHash["自分から話すより聞き手に回るほうが多い"], dataHash["他の人を褒めるのは得意だ"]);
            let recoveryDaydreamArray = createBubbleDataset(dataHash["嫌なことがあっても一晩寝ると忘れる"], dataHash["空想にふけるのが好きだ"]);

            const dataGetUpGoOut = {
                datasets: [{
                    label: "",
                    backgroundColor: "rgba(135, 206, 250, 0.6)",
                    borderColor: "rgba(135, 206, 250, 1.0)",
                    borderWidth: 1.0,
                    data: getUpGoOutArray
                }]
            };

            const dataStudyProgramming = {
                datasets: [{
                    label: "",
                    backgroundColor: "rgba(135, 206, 250, 0.6)",
                    borderColor: "rgba(135, 206, 250, 1.0)",
                    borderWidth: 1.0,
                    data: studyProgrammingArray
                }]
            };

            const dataListenPraise = {
                datasets: [{
                    label: "",
                    backgroundColor: "rgba(135, 206, 250, 0.6)",
                    borderColor: "rgba(135, 206, 250, 1.0)",
                    borderWidth: 1.0,
                    data: listenPraiseArray
                }]
            };

            const dataRecoveryDaydream = {
                datasets: [{
                    label: "",
                    backgroundColor: "rgba(135, 206, 250, 0.6)",
                    borderColor: "rgba(135, 206, 250, 1.0)",
                    borderWidth: 1.0,
                    data: recoveryDaydreamArray
                }]
            };

            const optionsBubbleFrame = {
                scales: {
                    x: {
                        grid: {
                            color: "rgba(245, 245, 245, 0.5)"
                        },
                        ticks: {
                            color: "rgba(245, 245, 245, 1.0)"
                        }
                    },
                    y: {
                        grid: {
                            color: "rgba(245, 245, 245, 0.5)"
                        },
                        ticks: {
                            color: "rgba(245, 245, 245, 1.0)"
                        }
                    },
                },
                plugins: plugins
            }

            let getUpGoOutSubtitle = createSubtitleBubble(dataHash["早起きが苦手だ"], dataHash["週末に出かけるのが好きだ"]);
            let studyProgrammingSubtitle = createSubtitleBubble(dataHash["勉強が好きだ"], dataHash["プログラミングができる"]);
            let listenPraiseSubtitle = createSubtitleBubble(dataHash["自分から話すより聞き手に回るほうが多い"], dataHash["他の人を褒めるのは得意だ"]);
            let recoveryDaydreamSubtitle = createSubtitleBubble(dataHash["嫌なことがあっても一晩寝ると忘れる"], dataHash["空想にふけるのが好きだ"]);

            const optionsGetUpGoOut = createOptions(
                optionsBubbleFrame, ["[横軸] 早起きが苦手だ", "[縦軸] 週末に出かけるのが好きだ"],
                getUpGoOutSubtitle);
            const optionsStudyProgramming = createOptions(
                optionsBubbleFrame, ["[横軸] 勉強が好きだ", "[縦軸] プログラミングができる"],
                studyProgrammingSubtitle);
            const optionsListenPraise = createOptions(
                optionsBubbleFrame, ["[横軸] 自分から話すより聞き手に回るほうが多い", "[縦軸] 他の人を褒めるのは得意だ"],
                listenPraiseSubtitle);
            const optionsRecoveryDaydream = createOptions(
                optionsBubbleFrame, ["[横軸] 嫌なことがあっても一晩寝ると忘れる", "[縦軸] 空想にふけるのが好きだ"],
                recoveryDaydreamSubtitle);

            const configGetUpGoOut = {
                type: "bubble",
                data: dataGetUpGoOut,
                options: optionsGetUpGoOut
            };

            const configStudyProgramming = {
                type: "bubble",
                data: dataStudyProgramming,
                options: optionsStudyProgramming
            };

            const configListenPraise = {
                type: "bubble",
                data: dataListenPraise,
                options: optionsListenPraise
            };

            const configRecoveryDaydream = {
                type: "bubble",
                data: dataRecoveryDaydream,
                options: optionsRecoveryDaydream
            };

            var bubbleGetUpGoOut = new Chart(document.getElementById("bubbleGetUpGoOut"), configGetUpGoOut);
            var bubbleStudyProgramming = new Chart(document.getElementById("bubbleStudyProgramming"), configStudyProgramming);
            var bubbleListenPraise = new Chart(document.getElementById("bubbleListenPraise"), configListenPraise);
            var bubbleRecoveryDaydream = new Chart(document.getElementById("bubbleRecoveryDaydream"), configRecoveryDaydream);

            // 各種関数

            function createURI(id, sheet, key) {
                let uri = "https://sheets.googleapis.com/v4/spreadsheets/";
                const path = "/values/";
                const query = "?key=";
                return uri.concat(id, path, sheet, query, key);
            };

            function createRanks(limits) {
                ranks = [];
                for (let i = 0; i < limits.length - 1; i++) {
                    ranks.push();
                    ranks[i] = "".concat(limits[i], "-", limits[i + 1]);
                }
                return ranks;
            }

            function createFrequencies(category, limits, gender = null) {
                let frequencies = [];
                for (let i = 0; i < limits.length; i++) {
                    frequencies[i] = 0;
                }
                for (let i = 0; i < dataHash[category].length; i++) {
                    for (let j = 0; j < limits.length - 1; j++) {
                        allocateToRanks(frequencies, category, i, limits, j, gender);
                    }
                }
                return frequencies;
            }

            function allocateToRanks(frequencies, category, catIdx, limits, limIdx, gender) {
                if (Number(dataHash[category][catIdx]) >= limits[limIdx] &&
                    Number(dataHash[category][catIdx]) < limits[limIdx + 1]) {
                    if (gender === "male") {
                        if (dataHash["性別"][catIdx] === "男性") {
                            frequencies[limIdx]++;
                        }
                    } else if (gender === "female") {
                        if (dataHash["性別"][catIdx] === "女性") {
                            frequencies[limIdx]++;
                        }
                    } else {
                        frequencies[limIdx]++;
                    }
                }
            }

            function devideByGenders(category, gender) {
                let array = [];
                for (let i = 0; i < dataHash[category].length; i++) {
                    if (dataHash["性別"][i] === gender) {
                        array.push(dataHash[category][i]);
                    }
                }
                return array;
            }

            function createSubtitleHist(array) {
                sort(array);
                let average = Math.round(getAverage(array) * 100) / 100;
                let max = Math.round(getMax(array) * 100) / 100;
                let min = Math.round(getMin(array) * 100) / 100;
                let median = Math.round(getMedian(array) * 100) / 100;
                let mode = Math.round(getMode(array) * 100) / 100;
                let standardDeviation = Math.round(getStandardDeviation(array) * 100) / 100;
                let subtitle = "".concat("平均: ", average, "  最大値: ", max,
                    "  最小値: ", min, "  中央値: ", median,
                    "  最頻値: ", mode, "  標準偏差: ", standardDeviation);
                return subtitle;
            }

            function createOptions(frame, title, subtitle) {
                let plugins;
                options = JSON.parse(JSON.stringify(frame));
                options.plugins.title.text = title;
                options.plugins.subtitle.text = subtitle;
                if (!title) {
                    options.plugins.title.display = false;
                }
                return options;
            }

            function createArray(category) {
                let array = [];
                for (let i = 0; i < labelsHash[category].length; i++) {
                    array[i] = 0;
                }
                for (let i = 0; i < dataHash[category].length; i++) {
                    for (let j = 0; j < labelsHash[category].length; j++) {
                        if (dataHash[category][i] === labelsHash[category][j]) {
                            array[j]++;
                        }
                    }
                }
                return array;
            }

            function createSubtitlePie(array) {
                let sum = getSum(array);
                let subtitle = "";
                for (let i = 0; i < array.length; i++) {
                    subtitle += (Math.ceil(array[i] / sum * 1000) / 10).toString() + "%          ";
                }
                return subtitle.slice(0, -10);
            }

            function createBubbleDataset(array1, array2) {
                let arrays = [];
                let dataset = [];
                let dupulicateValues = [];
                let dupulicateIdxs = [];
                if (array1.length === array2.length) {
                    for (let i = 0; i < array1.length; i++) {
                        arrays.push([Number(array1[i]), Number(array2[i])])
                    }
                }
                for (let i = 0; i < arrays.length; i++) {
                    for (let j = i; j < arrays.length; j++) {
                        if (arrays[i][0] === arrays[j][0] &&
                            arrays[i][1] === arrays[j][1]) {
                            dupulicateValues.push([arrays[i][0], arrays[i][1]]);
                            if (arrays[i][2]) {
                                arrays[i][2]++;
                            } else {
                                arrays[i][2] = 1;
                                let tmp = 1;
                                for (let k = 0; k < dupulicateValues.length; k++) {
                                    if (dupulicateValues[k][0] !== arrays[i][0] ||
                                        dupulicateValues[k][1] !== arrays[i][1]) {
                                        tmp++;
                                    }
                                }
                                if (tmp < dupulicateValues.length) {
                                    dupulicateIdxs.push(i);
                                }
                            }
                        }
                    }
                }
                for (let i = 0; i < dupulicateIdxs.length; i++) {
                    arrays.splice(dupulicateIdxs[i], 1);
                    for (let j = 0; j < dupulicateIdxs.length; j++) {
                        dupulicateIdxs[j]--;
                    }
                }
                for (let i = 0; i < arrays.length; i++) {
                    let hash = {};
                    hash["x"] = arrays[i][0];
                    hash["y"] = arrays[i][1];
                    hash["r"] = arrays[i][2];
                    dataset.push(hash);
                }
                return dataset;
            }

            function createSubtitleBubble(array1, array2) {
                let correlation = getCorrelation(array1, array2);
                let subtitle = "相関係数: " + Math.round(correlation * 100) / 100;
                return subtitle;
            }

            // 基本統計量を求める関数群

            function getSum(array) {
                let sum = 0;
                for (let i = 0; i < array.length; i++) {
                    sum += Number(array[i]);
                }
                return sum;
            }

            function getAverage(array) {
                let sum = getSum(array);
                return sum / array.length;
            }

            function getStandardDeviation(array) {
                let resisualSumOfSquares = 0;
                let average = getAverage(array);
                for (let i = 0; i < array.length; i++) {
                    let deviation = Number(array[i]) - average;
                    resisualSumOfSquares += deviation * deviation;
                }
                let variance = resisualSumOfSquares / (array.length - 1);
                return Math.sqrt(variance);
            }

            function getCovariance(array1, array2) {
                let sumOfProductsOfDeviations = 0;
                let covariance;
                let average1 = getAverage(array1);
                let average2 = getAverage(array2);
                if (array1.length === array2.length) {
                    for (let i = 0; i < array1.length; i++) {
                        let deviation1 = Number(array1[i]) - average1;
                        let deviation2 = Number(array2[i]) - average2;
                        let productOfdeviations = deviation1 * deviation2;
                        sumOfProductsOfDeviations += productOfdeviations;
                    }
                    covariance = sumOfProductsOfDeviations / (array1.length - 1);
                }
                return covariance;
            }

            function getCorrelation(array1, array2) {
                let covariance = getCovariance(array1, array2);
                let standardDeviation1 = getStandardDeviation(array1);
                let standardDeviation2 = getStandardDeviation(array2);
                let correlation = covariance / (standardDeviation1 * standardDeviation2);
                return correlation;
            }

            function sort(array) {
                for (let i = 0; i < array.length; i++) {
                    for (let j = i; j < array.length; j++) {
                        if (Number(array[i]) > Number(array[j])) {
                            tmp = array[i];
                            array[i] = array[j];
                            array[j] = tmp;
                        }
                    }
                }
            }

            function getMax(sortedArray) {
                return sortedArray[sortedArray.length - 1];
            }

            function getMin(sortedArray) {
                return sortedArray[0];
            }

            function getMedian(sortedArray) {
                let median;
                if (sortedArray.length % 2 === 0) {
                    let smaller = Number(sortedArray[sortedArray.length / 2 - 1]);
                    let bigger = Number(sortedArray[sortedArray.length / 2]);
                    median = (smaller + bigger) / 2;
                } else {
                    median = Number(sortedArray[Math.ceil(sortedArray.length / 2 - 1)]);
                }
                return Math.round(median * 100) / 100;
            }

            function getMode(sortedArray) {
                let maxFrequency = 1;
                let frequency = 1;
                let mode;
                for (let i = 1; i < sortedArray.length; i++) {
                    frequency++;
                    if (Number(sortedArray[i]) !== Number(sortedArray[i - 1])) {
                        frequency = 1;
                    }
                    if (frequency > maxFrequency) {
                        maxFrequency = frequency;
                        mode = Number(sortedArray[i]);
                    }
                }
                return mode;
            }
        });
    </script>
</head>

<body class="bg-dark text-light">
    <div class="container mx-4 my-5">
        <h3>概要</h3>
        <div class="my-4">
            <p>ぜひ、
                <a href="https://forms.gle/PXEY4Ewg3ZC3JPsQ7" target="_blank">こちら</a> からアンケートにお答えください。
            </p>
            <p>ページを更新すると集計結果が以下に反映されます。</p>
        </div>
        <hr>
        <h3 class="my-4">集計結果</h3>
        <h4 class="my-4">ヒストグラム</h4>
        <div class="row row-cols-2 my-3">
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="histAge"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="histHeightAll"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="histHeightGenders"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="histSleep"></canvas>
            </div>
            <div class="col p-2 m-1 " style="width: 80vh;">
                <canvas id="histTemperatureAll"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="histTemperatureGenders"></canvas>
            </div>
        </div>
        <hr>
        <h4 class="my-4">円グラフ</h4>
        <div class="row row-cols-2 my-3">
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieGender"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieSubject"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieBreakfast"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieArt"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieBill"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieNews"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieGetUp"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieStudy"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieProgramming"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieGoOut"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieListen"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieRecovery"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="pieDaydream"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="piePraise"></canvas>
            </div>
        </div>
        <hr>
        <h4 class="my-4">バブルチャート</h4>
        <div class="row row-cols-2 my-3">
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="bubbleGetUpGoOut"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="bubbleStudyProgramming"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="bubbleListenPraise"></canvas>
            </div>
            <div class="col p-2 m-1" style="width: 80vh;">
                <canvas id="bubbleRecoveryDaydream"></canvas>
            </div>
        </div>
    </div>
</body>

</html>
